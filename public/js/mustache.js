!function(t,e){"object"==typeof exports&&exports?module.exports=e:"function"==typeof define&&define.amd?define(e):t.Mustache=e}(this,function(){var t={name:"mustache.js",version:"0.7.2",tags:["{{","}}"]};t.Scanner=p,t.Context=h,t.Writer=f;var e=/\s*/,n=/\s+/,r=/\S/,i=/\s*=/,a=/\s*\}/,o=/#|\^|\/|>|\{|&|=|!/;function s(t){return!function(t,e){return RegExp.prototype.test.call(t,e)}(r,t)}var c=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function u(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function p(t){this.string=t,this.tail=t,this.pos=0}function h(t,e){this.view=t,this.parent=e,this.clearCache()}function f(){this.clearCache()}function v(t){return[new RegExp(u(t[0])+"\\s*"),new RegExp("\\s*"+u(t[1]))]}t.escape=function(t){return String(t).replace(/[&<>"'\/]/g,function(t){return l[t]})},p.prototype.eos=function(){return""===this.tail},p.prototype.scan=function(t){var e=this.tail.match(t);return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},p.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return e},h.make=function(t){return t instanceof h?t:new h(t)},h.prototype.clearCache=function(){this._cache={}},h.prototype.push=function(t){return new h(t,this)},h.prototype.lookup=function(t){var e=this._cache[t];if(!e){if("."===t)e=this.view;else for(var n=this;n;){if(t.indexOf(".")>0){var r=t.split("."),i=0;for(e=n.view;e&&i<r.length;)e=e[r[i++]]}else e=n.view[t];if(null!=e)break;n=n.parent}this._cache[t]=e}return"function"==typeof e&&(e=e.call(this.view)),e},f.prototype.clearCache=function(){this._cache={},this._partialCache={}},f.prototype.compile=function(e,n){var r=this._cache[e];if(!r){var i=t.parse(e,n);r=this._cache[e]=this.compileTokens(i,e)}return r},f.prototype.compilePartial=function(t,e,n){var r=this.compile(e,n);return this._partialCache[t]=r,r},f.prototype.compileTokens=function(t,e){var n=function t(e){var n={};function r(e,r,i){if(!n[e]){var a=t(r);n[e]=function(t,e){return a(t,e,i)}}return n[e]}return function(t,n,i){for(var a,o,s="",c=0,u=e.length;c<u;++c)switch((a=e[c])[0]){case"#":o=i.slice(a[3],a[5]),s+=t._section(a[1],n,o,r(c,a[4],i));break;case"^":s+=t._inverted(a[1],n,r(c,a[4],i));break;case">":s+=t._partial(a[1],n);break;case"&":s+=t._name(a[1],n);break;case"name":s+=t._escaped(a[1],n);break;case"text":s+=a[1]}return s}}(t),r=this;return function(t,i){if(i)if("function"==typeof i)r._loadPartial=i;else for(var a in i)r.compilePartial(a,i[a]);return n(r,h.make(t),e)}},f.prototype.render=function(t,e,n){return this.compile(t)(e,n)},f.prototype._section=function(t,e,n,r){var i=e.lookup(t);switch(typeof i){case"object":if(c(i)){for(var a="",o=0,s=i.length;o<s;++o)a+=r(this,e.push(i[o]));return a}return i?r(this,e.push(i)):"";case"function":var u=this,l=i.call(e.view,n,function(t){return u.render(t,e)});return null!=l?l:"";default:if(i)return r(this,e)}return""},f.prototype._inverted=function(t,e,n){var r=e.lookup(t);return!r||c(r)&&0===r.length?n(this,e):""},f.prototype._partial=function(t,e){t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t));var n=this._partialCache[t];return n?n(e):""},f.prototype._name=function(t,e){var n=e.lookup(t);return"function"==typeof n&&(n=n.call(e.view)),null==n?"":String(n)},f.prototype._escaped=function(e,n){return t.escape(this._name(e,n))},t.parse=function(r,c){if(r=r||"","string"==typeof(c=c||t.tags)&&(c=c.split(n)),2!==c.length)throw new Error("Invalid tags: "+c.join(", "));var l,h,f,g,w=v(c),m=new p(r),y=[],d=[],_=[],k=!1,b=!1;function x(){if(k&&!b)for(;_.length;)d.splice(_.pop(),1);else _=[];k=!1,b=!1}for(;!m.eos();){if(l=m.pos,f=m.scanUntil(w[0]))for(var C=0,U=f.length;C<U;++C)s(g=f.charAt(C))?_.push(d.length):b=!0,d.push(["text",g,l,l+1]),l+=1,"\n"===g&&x();if(l=m.pos,!m.scan(w[0]))break;if(k=!0,h=m.scan(o)||"name",m.scan(e),"="===h)f=m.scanUntil(i),m.scan(i),m.scanUntil(w[1]);else if("{"===h){var E=new RegExp("\\s*"+u("}"+c[1]));f=m.scanUntil(E),m.scan(a),m.scanUntil(w[1]),h="&"}else f=m.scanUntil(w[1]);if(!m.scan(w[1]))throw new Error("Unclosed tag at "+m.pos);if("/"===h){if(0===y.length)throw new Error('Unopened section "'+f+'" at '+l);var P;if((P=y.pop())[1]!==f)throw new Error('Unclosed section "'+P[1]+'" at '+l)}var j=[h,f,l,m.pos];if(d.push(j),"#"===h||"^"===h)y.push(j);else if("name"===h||"{"===h||"&"===h)b=!0;else if("="===h){if(2!==(c=f.split(n)).length)throw new Error("Invalid tags at "+l+": "+c.join(", "));w=v(c)}}if(P=y.pop())throw new Error('Unclosed section "'+P[1]+'" at '+m.pos);return function(t){for(var e,n=[],r=n,i=[],a=0,o=t.length;a<o;++a)switch((e=t[a])[0]){case"#":case"^":i.push(e),r.push(e),r=e[4]=[];break;case"/":i.pop()[5]=e[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(e)}return n}(function(t){for(var e,n,r=[],i=0,a=t.length;i<a;++i)"text"===(e=t[i])[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(n=e,r.push(e));return r}(d))};var g=new f;return t.clearCache=function(){return g.clearCache()},t.compile=function(t,e){return g.compile(t,e)},t.compilePartial=function(t,e,n){return g.compilePartial(t,e,n)},t.compileTokens=function(t,e){return g.compileTokens(t,e)},t.render=function(t,e,n){return g.render(t,e,n)},t.to_html=function(e,n,r,i){var a=t.render(e,n,r);if("function"!=typeof i)return a;i(a)},t}());